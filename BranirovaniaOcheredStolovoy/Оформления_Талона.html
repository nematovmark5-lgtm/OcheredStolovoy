<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Столовая - Заказ еды</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --accent-color: #FF9800;
            --light-color: #f5f5f5;
            --dark-color: #333;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --success-color: #4caf50;
            --error-color: #f44336;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), #2E7D32);
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow);
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            opacity: 0.9;
        }
        
        .main-container {
            display: flex;
            flex: 1;
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .menu-container {
            flex: 3;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .cart-container {
            flex: 2;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            min-width: 300px;
            position: relative;
        }
        
        .tabs {
            display: flex;
            background: var(--light-color);
            border-bottom: 2px solid #ddd;
        }
        
        .tab {
            padding: 1.2rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            flex: 1;
            position: relative;
        }
        
        .tab.active {
            background: white;
            color: var(--primary-color);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary-color);
        }
        
        .tab-content {
            padding: 1.5rem;
            display: none;
            flex-direction: column;
            gap: 1.2rem;
            overflow-y: auto;
            flex: 1;
        }
        
        .tab-content.active {
            display: flex;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 1.2rem;
            border-radius: 10px;
            background: var(--light-color);
            transition: all 0.3s ease;
            cursor: pointer;
            gap: 1.2rem;
            border: 2px solid transparent;
        }
        
        .menu-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }
        
        .menu-item.selected {
            border-color: var(--primary-color);
            background-color: #e8f5e9;
        }
        
        .menu-item.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .menu-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        
        .item-desc {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .item-price {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .add-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2rem;
        }
        
        .add-btn:hover {
            background: #2E7D32;
            transform: scale(1.1);
        }
        
        .cart-title {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #eee;
        }
        
        .cart-title i {
            color: var(--primary-color);
            font-size: 1.5rem;
        }
        
        .cart-title h2 {
            font-size: 1.5rem;
        }
        
        .cart-items {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 1.5rem;
        }
        
        .cart-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: 8px;
            background: #f9f9f9;
            margin-bottom: 0.8rem;
            gap: 0.8rem;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .cart-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-title {
            font-weight: 500;
            font-size: 1rem;
            margin-bottom: 0.3rem;
        }
        
        .cart-item-price {
            color: var(--primary-color);
            font-size: 0.9rem;
        }
        
        .remove-btn {
            background: var(--error-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
        }
        
        .remove-btn:hover {
            background: #d32f2f;
        }
        
        .cart-total {
            padding: 1rem 0;
            border-top: 2px solid #eee;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
        }
        
        .checkout-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 1.2rem;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.3s;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .checkout-btn:hover {
            background: #2E7D32;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .checkout-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .empty-cart {
            text-align: center;
            color: #888;
            padding: 2rem;
        }
        
        .empty-cart i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }
        
        /* Анимация добавления в корзину - ИСПРАВЛЕННАЯ */
        @keyframes flyToCart {
            0% {
                opacity: 1;
                transform: scale(0.1) translate(0, 0) rotate(0deg);
            }
            50% {
                opacity: 0.9;
                transform: scale(0.9) translate(0, 0) rotate(0deg);
            }
            100% {
                opacity: 0.7;
                transform: scale(0.8) translate(var(--fly-x), var(--fly-y)) rotate(0deg);
            }
            
        }
        
        .fly-item {
            position: fixed;
            z-index: 1000;
            pointer-events: none;
            animation: flyToCart 1s ease-in-out forwards;
        }
        
        /* Стили для существующих элементов */
        .hidden {
            display: none;
        }
        
        .order-success {
            text-align: center;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            max-width: 500px;
            margin: 2rem auto;
            animation: fadeIn 0.5s ease;
        }
        
        .success-icon {
            font-size: 4rem;
            color: var(--success-color);
            margin-bottom: 1.5rem;
            animation: bounce 1s ease;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }
        
        .order-number {
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 1.5rem 0;
            color: var(--secondary-color);
            padding: 1rem;
            background: #e3f2fd;
            border-radius: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        .order-info {
            text-align: center;
            font-size: 1.1rem;
            margin: 1rem 0;
            padding: 1.5rem;
            background-color: #e8f5e9;
            border-radius: 8px;
            color: #2e7d32;
            line-height: 1.5;
        }
        
        .countdown {
            text-align: center;
            font-size: 1.1rem;
            color: #757575;
            margin: 1.5rem 0;
            padding: 1rem;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 2rem;
        }
        
        .mini-loading {
            text-align: center;
            color: #666;
            font-style: italic;
            margin: 1.5rem 0;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--secondary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .cart-container {
                min-width: auto;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
        }
        
        .payment-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .payment-animation.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .payment-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: scaleIn 0.5s ease;
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .payment-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Столовая - Заказ еды</h1>
        <p>Выберите одно блюдо и один напиток</p>
    </div>
    
    <div class="main-container" id="mainContainer">
        <div class="menu-container">
            <div class="tabs">
                <div class="tab active" data-tab="food">Блюда</div>
                <div class="tab" data-tab="drink">Напитки</div>
            </div>
            
            <div id="foodTab" class="tab-content active">
                <div class="menu-item" data-id="1" data-name="Суп куриный" data-type="food" data-price="120" data-img="https://p0.zoon.ru/preview/PIbiR5TaPSBBQEmEUprgVA/800x800x85/1/2/6/original_681872116a699e7ebe024baf_68187305ab83b5.89129560.jpg">
                    <img src="https://p0.zoon.ru/preview/PIbiR5TaPSBBQEmEUprgVA/800x800x85/1/2/6/original_681872116a699e7ebe024baf_68187305ab83b5.89129560.jpg" alt="Суп куриный">
                    <div class="item-info">
                        <div class="item-title">Суп куриный</div>
                        <div class="item-desc">Ароматный куриный суп с овощами и зеленью</div>
                        <div class="item-price">120 руб.</div>
                    </div>
                    <button class="add-btn"><i class="fas fa-plus"></i></button>
                </div>
                
                <div class="menu-item" data-id="2" data-name="Гречка с куриной котлеткой" data-type="food" data-price="180" data-img="https://main-cdn.sbermegamarket.ru/hlr-system/-12/258/236/021/226/122/0/100030010641b0.jpg">
                    <img src="https://main-cdn.sbermegamarket.ru/hlr-system/-12/258/236/021/226/122/0/100030010641b0.jpg" alt="Гречка с куриной котлеткой">
                    <div class="item-info">
                        <div class="item-title">Гречка с куриной котлеткой</div>
                        <div class="item-desc">Гречневая каша с сочной куриной котлетой и овощами</div>
                        <div class="item-price">180 руб.</div>
                    </div>
                    <button class="add-btn"><i class="fas fa-plus"></i></button>
                </div>
                
                <div class="menu-item" data-id="3" data-name="Пюрешка с рыбной котлеткой" data-type="food" data-price="160" data-img="https://static.tildacdn.com/stor6165-3065-4338-a562-363736303434/82864041.jpg">
                    <img src="https://static.tildacdn.com/stor6165-3065-4338-a562-363736303434/82864041.jpg" alt="Пюрешка с рыбной котлеткой">
                    <div class="item-info">
                        <div class="item-title">Пюрешка с рыбной котлеткой</div>
                        <div class="item-desc">Нежное картофельное пюре с хрустящей рыбной котлетой</div>
                        <div class="item-price">160 руб.</div>
                    </div>
                    <button class="add-btn"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            
            <div id="drinkTab" class="tab-content">
                <div class="menu-item" data-id="4" data-name="Компот вишнёвый" data-type="drink" data-price="50" data-img="https://img.vkusvill.ru/pim/images/site_LargeWebP/5d9f9fc4-1bf5-4d6f-8afd-72197655b06b.webp?1701773692.5693">
                    <img src="https://img.vkusvill.ru/pim/images/site_LargeWebP/5d9f9fc4-1bf5-4d6f-8afd-72197655b06b.webp?1701773692.5693" alt="Компот вишнёвый">
                    <div class="item-info">
                        <div class="item-title">Компот вишнёвый</div>
                        <div class="item-desc">Освежающий вишнёвый компот домашнего приготовления</div>
                        <div class="item-price">50 руб.</div>
                    </div>
                    <button class="add-btn"><i class="fas fa-plus"></i></button>
                </div>
                
                <div class="menu-item" data-id="5" data-name="Компот персиковый" data-type="drink" data-price="50" data-img="https://kruton.by/iimgs/cats/1399.jpg">
                    <img src="https://kruton.by/iimgs/cats/1399.jpg" alt="Компот персиковый">
                    <div class="item-info">
                        <div class="item-title">Компот персиковый</div>
                        <div class="item-desc">Сладкий персиковый компот с кусочками фруктов</div>
                        <div class="item-price">50 руб.</div>
                    </div>
                    <button class="add-btn"><i class="fas fa-plus"></i></button>
                </div>
                
                <div class="menu-item" data-id="6" data-name="Чай" data-type="drink" data-price="40" data-img="https://a.d-cd.net/d7b6082s-960.jpg">
                    <img src="https://a.d-cd.net/d7b6082s-960.jpg" alt="Чай">
                    <div class="item-info">
                        <div class="item-title">Чай</div>
                        <div class="item-desc">Ароматный черный или зеленый чай на выбор</div>
                        <div class="item-price">40 руб.</div>
                    </div>
                    <button class="add-btn"><i class="fas fa-plus"></i></button>
                </div>
                
                <div class="menu-item" data-id="7" data-name="Тёплая водичка" data-type="drink" data-price="20" data-img="https://i.pinimg.com/736x/36/39/55/363955ca23cb9046fc7692545f815fd5.jpg">
                    <img src="https://i.pinimg.com/736x/36/39/55/363955ca23cb9046fc7692545f815fd5.jpg" alt="Тёплая водичка">
                    <div class="item-info">
                        <div class="item-title">Тёплая водичка</div>
                        <div class="item-desc">Стакан теплой питьевой воды с лимоном</div>
                        <div class="item-price">20 руб.</div>
                    </div>
                    <button class="add-btn"><i class="fas fa-plus"></i></button>
                </div>
            </div>
        </div>
        
        <div class="cart-container">
            <div class="cart-title">
                <i class="fas fa-shopping-cart"></i>
                <h2>Ваша корзина</h2>
            </div>
            
            <div class="cart-items">
                <div class="empty-cart">
                    <i class="fas fa-shopping-basket"></i>
                    <p>Корзина пуста</p>
                    <p>Добавьте товары из меню</p>
                </div>
                <!-- Сюда будут добавляться товары -->
            </div>
            
            <div class="cart-total">
                <span>Итого:</span>
                <span id="cart-total-price">0 руб.</span>
            </div>
            
            <button class="checkout-btn" id="checkout-btn" disabled>
                <i class="fas fa-credit-card"></i>
                Оплатить заказ
            </button>
        </div>
    </div>
    
    <!-- Анимация оплаты -->
    <div class="payment-animation" id="payment-animation">
        <div class="payment-content">
            <div class="payment-spinner"></div>
            <h2>Идет обработка оплаты...</h2>
            <p>Пожалуйста, подождите</p>
        </div>
    </div>
    
    <!-- Существующие секции (оставлены без изменений) -->
    <div id="loadingSection" class="hidden">
        <div class="loading">Загрузка меню...</div>
    </div>
    
    <div id="orderResult" class="hidden">
        <div class="order-success">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2>Оплата прошла успешно!</h2>
            <p>Ваш заказ принят в обработку</p>
            
            <div class="order-number">Ваш номер заказа: <span id="orderNumber"></span></div>
            
            <div class="order-info">
                Когда ваш заказ будет готов, он появится в окне заказов.<br>
                Вы можете запомнить номер или сфотографировать его.
            </div>
            
            <div class="countdown">Автоматическое обновление через: <span id="countdown">10</span> секунд</div>
        </div>
    </div>

    <div id="orderProcessing" class="hidden">
        <div class="mini-loading">
            <div class="spinner"></div>
            <div>Проверяем доступные номера...</div>
        </div>
    </div>

    <script>
        // Данные для корзины
        let cart = [];
        let selectedFood = null;
        let selectedDrink = null;
        let orderNumber = 0;
        let countdownInterval;
        
        const foodOptions = {
            1: 'Суп куриный',
            2: 'Гречка с куриной котлеткой',
            3: 'Пюрешка с рыбной котлеткой'
        };
        
        const drinkOptions = {
            1: 'Компот вишнёвый',
            2: 'Компот персиковый',
            3: 'Чай',
            4: 'Тёплая водичка'
        };
        
        const SERVER_URL = 'http://192.168.1.215:5000'; // Исправленный адрес сервера
        
        // Инициализация при загрузке страницы
        window.onload = function() {
            initTabs();
            initAddToCartButtons();
            getNextOrderNumber();
        };
        
        // Инициализация табов
        function initTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Убираем активный класс у всех табов
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    
                    // Добавляем активный класс к выбранному табу
                    tab.classList.add('active');
                    const tabName = tab.getAttribute('data-tab');
                    document.getElementById(`${tabName}Tab`).classList.add('active');
                });
            });
        }
        
        // Инициализация кнопок добавления в корзину
        function initAddToCartButtons() {
            document.querySelectorAll('.add-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const menuItem = this.closest('.menu-item');
                    addToCart(menuItem);
                });
            });
        }
        
        // Добавление товара в корзину с анимацией - ИСПРАВЛЕННАЯ
        function addToCart(menuItem) {
            const id = menuItem.getAttribute('data-id');
            const name = menuItem.getAttribute('data-name');
            const type = menuItem.getAttribute('data-type');
            const price = parseInt(menuItem.getAttribute('data-price'));
            const img = menuItem.getAttribute('data-img');
            
            // Проверяем, можно ли добавить этот тип товара
            if (type === 'food' && selectedFood !== null) {
                alert('Вы уже выбрали блюдо. Удалите его из корзины, чтобы выбрать другое.');
                return;
            }
            
            if (type === 'drink' && selectedDrink !== null) {
                alert('Вы уже выбрали напиток. Удалите его из корзины, чтобы выбрать другой.');
                return;
            }
            
            // Создаем летящий элемент для анимации
            const flyItem = document.createElement('div');
            flyItem.className = 'fly-item';
            flyItem.innerHTML = `<img src="${img}" alt="${name}" style="width: 50px; height: 50px;">`;
            
            // Позиционируем летящий элемент
            const rect = menuItem.getBoundingClientRect();
            const cartRect = document.querySelector('.cart-container').getBoundingClientRect();
            
            flyItem.style.left = `${rect.left + rect.width/2 - 25}px`;
            flyItem.style.top = `${rect.top + rect.height/2 - 25}px`;
            
            // Вычисляем направление полета к корзине
            const flyX = cartRect.left - rect.left + (cartRect.width / 2) - 25;
            const flyY = cartRect.top - rect.top + 50;
            
            flyItem.style.setProperty('--fly-x', `${flyX}px`);
            flyItem.style.setProperty('--fly-y', `${flyY}px`);
            
            document.body.appendChild(flyItem);
            
            // Помечаем товар как выбранный
            menuItem.classList.add('selected');
            
            // Делаем другие товары того же типа недоступными
            if (type === 'food') {
                document.querySelectorAll('.menu-item[data-type="food"]').forEach(item => {
                    if (item.getAttribute('data-id') !== id) {
                        item.classList.add('disabled');
                    }
                });
                selectedFood = id;
            } else {
                document.querySelectorAll('.menu-item[data-type="drink"]').forEach(item => {
                    if (item.getAttribute('data-id') !== id) {
                        item.classList.add('disabled');
                    }
                });
                selectedDrink = id;
            }
            
            // Удаляем летящий элемент после анимации
            setTimeout(() => {
                document.body.removeChild(flyItem);
                
                // Добавляем товар в корзину
                cart.push({
                    id,
                    name,
                    type,
                    price,
                    img,
                    quantity: 1
                });
                
                updateCart();
                
            }, 1000); // Время должно совпадать с длительностью анимации
        }
        
        // Обновление отображения корзины
        function updateCart() {
            const cartItems = document.querySelector('.cart-items');
            const totalElement = document.getElementById('cart-total-price');
            const checkoutBtn = document.getElementById('checkout-btn');
            
            // Очищаем корзину
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-basket"></i>
                        <p>Корзина пуста</p>
                        <p>Добавьте товары из меню</p>
                    </div>
                `;
                totalElement.textContent = '0 руб.';
                checkoutBtn.disabled = true;
                return;
            }
            
            // Добавляем товары в корзину
            let total = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <img src="${item.img}" alt="${item.name}">
                    <div class="cart-item-info">
                        <div class="cart-item-title">${item.name}</div>
                        <div class="cart-item-price">${item.price} руб.</div>
                    </div>
                    <button class="remove-btn" data-id="${item.id}"><i class="fas fa-times"></i></button>
                `;
                
                cartItems.appendChild(cartItem);
            });
            
            // Добавляем обработчики для кнопок удаления
            document.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    removeFromCart(id);
                });
            });
            
            totalElement.textContent = `${total} руб.`;
            
            // Активируем кнопку оплаты, если есть и еда, и напиток
            checkoutBtn.disabled = !(selectedFood && selectedDrink);
        }
        
        // Удаление товара из корзины
        function removeFromCart(id) {
            // Находим товар в корзине
            const itemIndex = cart.findIndex(item => item.id === id);
            if (itemIndex === -1) return;
            
            const item = cart[itemIndex];
            
            // Удаляем товар из корзины
            cart.splice(itemIndex, 1);
            
            // Снимаем выделение с товара в меню
            const menuItem = document.querySelector(`.menu-item[data-id="${id}"]`);
            if (menuItem) {
                menuItem.classList.remove('selected');
            }
            
            // Делаем другие товары того же типа снова доступными
            if (item.type === 'food') {
                document.querySelectorAll('.menu-item[data-type="food"]').forEach(item => {
                    item.classList.remove('disabled');
                });
                selectedFood = null;
            } else {
                document.querySelectorAll('.menu-item[data-type="drink"]').forEach(item => {
                    item.classList.remove('disabled');
                });
                selectedDrink = null;
            }
            
            // Обновляем корзину
            updateCart();
        }
        
        // Оплата заказа
        function proceedToCheckout() {
            // Показываем анимацию оплаты
            const paymentAnimation = document.getElementById('payment-animation');
            paymentAnimation.classList.add('active');
            
            // Имитируем процесс оплаты
            setTimeout(() => {
                paymentAnimation.classList.remove('active');
                
                // Определяем выбранные блюда и напитки
                let food = '';
                let drink = '';
                
                cart.forEach(item => {
                    if (item.type === 'food') {
                        food = item.name;
                    } else {
                        drink = item.name;
                    }
                });
                
                selectedFood = food;
                selectedDrink = drink;
                
                // Показываем индикатор загрузки
                document.getElementById('mainContainer').classList.add('hidden');
                document.getElementById('orderProcessing').classList.remove('hidden');
                
                // Получаем номер заказа и отправляем на сервер
                getOrderNumberAndSubmit();
                
            }, 3000); // Имитация процесса оплаты в течение 3 секунд
        }
        
        // Назначаем обработчик на кнопку оплаты
        document.getElementById('checkout-btn').addEventListener('click', proceedToCheckout);
        
        // Функция для получения следующего номера заказа из базы данных
        async function getNextOrderNumber() {
            try {
                const response = await fetch(`${SERVER_URL}/api/last_order`);
                if (!response.ok) {
                    throw new Error(`Ошибка HTTP: ${response.status}`);
                }
                const data = await response.json();
                
                if (data.next_order) {
                    orderNumber = data.next_order;
                } else {
                    // Если нет данных, начинаем с 100
                    orderNumber = 100;
                }
                
            } catch (error) {
                console.error('Error getting last order:', error);
                // В случае ошибки начинаем с 100
                orderNumber = 100;
            }
        }
        
        async function getOrderNumberAndSubmit() {
            try {
                // Получаем актуальный номер заказа из базы
                const response = await fetch(`${SERVER_URL}/api/last_order`);
                if (!response.ok) {
                    throw new Error(`Ошибка HTTP: ${response.status}`);
                }
                const data = await response.json();
                
                if (data.next_order) {
                    orderNumber = data.next_order;
                }
                
                // Показываем результат
                document.getElementById('orderProcessing').classList.add('hidden');
                document.getElementById('orderNumber').textContent = orderNumber;
                document.getElementById('orderResult').classList.remove('hidden');
                
                // Отправляем данные на сервер
                sendOrderToServer();
                
                // Запускаем обратный отсчет
                startCountdown();
                
            } catch (error) {
                console.error('Error getting order number:', error);
                // В случае ошибки используем предыдущий номер
                document.getElementById('orderProcessing').classList.add('hidden');
                document.getElementById('orderNumber').textContent = orderNumber;
                document.getElementById('orderResult').classList.remove('hidden');
                
                sendOrderToServer();
                startCountdown();
            }
        }
        
        function sendOrderToServer() {
            const orderData = {
                food: selectedFood,
                drink: selectedDrink
            };
            
            fetch(`${SERVER_URL}/api/order`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(orderData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Ошибка HTTP: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Order saved:', data);
            })
            .catch(error => {
                console.error('Error saving order:', error);
            });
        }
        
        function startCountdown() {
            let seconds = 10;
            const countdownElement = document.getElementById('countdown');
            
            countdownInterval = setInterval(() => {
                seconds--;
                countdownElement.textContent = seconds;
                
                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    location.reload();
                }
            }, 1000);
        }
    </script>
</body>
</html>